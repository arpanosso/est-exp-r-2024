---
title: "Lista-07"
author: "Panosso, AR"
date: "2024-12-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      error = FALSE,
                      warning = FALSE)
```

## Análise de dados de remoção de carbono (Perú)

  1. Downlaod
  1. Faxina de dados
  1. Pré-processamento
  1. Análise estatistica descritiva
  1. Análise multivariada para a série temporal
  1. Mapeamento


## Download dos dados

Dados podem ser encontrados em "www.climatetrace.org". Vários arquivos do tipo `.csv` se encontram na pasta data-raw/per, referentes a diferentes fontes de emissão de gases do efeito estufa para o país.

## Carregando os pacotes.
```{r}
library(tidyverse)
library(readxl)
library(abjutils)
```

## Ler os arquivos .csv

### Criar a lista de arquivos. 15 arquivos no total/

```{r}

pastas <- list.files("../data-raw/per/")
for(i in seq_along(pastas)){
  files <-list.files(paste0("../data-raw/per/",pastas[i]),
             pattern = "sources.csv$",full.names = TRUE)
  df <- map_df(files,my_file_reader)
  write_csv(df,paste0("../data-raw/per/",pastas[i],".csv"))
}

```

### Ler um arquivo da lista.

```{r}
my_file_reader <- function(path){
  read.csv(path) |> 
    select(source_id:capacity_factor)
}
# my_file_reader(lista_csv[1])
dados <- map_df(lista_csv,my_file_reader)
```

### Criar uma função para ler e guardar o caminho.
```{r}

```

### Aplicar a função para todos os arquivos da lista
```{r}

```

### Preparo dos dados.

A patir da coluna `end_time`, criar o ano e o mês referente à avaliação, filtrar os dados para emissão de CO2 equivalente 100 anos `co2e_100yr`. Apenas para o setor de `forestry-and-land-use`. Criar a soma das das `emission_ _quantity`.

```{r}
dados |> 
  mutate(
    year = year(end_time),
    month = month(end_time),
  ) |> filter(
    gas == "co2e_100yr",
    year == 2022,
    source_name == "Abancay",
    sector == "forestry-and-land-use") |> 
  pull(subsector) |> unique()

```


```{r}
dados |> 
  mutate(
    year = year(end_time),
    month = month(end_time),
  ) |> filter(
    gas == "co2e_100yr",
    year == 2022,
    source_name == "Abancay",
    sector != "forestry-and-land-use",
    # !subsector %in% c("forest-land-clearing",
    #                    "forest-land-degradation",
    #                    "shrubgrass-fires",
    #                    "forest-land-fires",
    #                    "wetland-fires",
    #                    "removals")
  ) |> 
  # group_by(subsector) |> 
  summarise(
    emission = sum(emissions_quantity)
  )
```

### Agregar os dados para emissão em 
